<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FORGE Theme System Test</title>
    
    <!-- Theme detection script (run before body to prevent FOUC) -->
    <script>
        (function() {
            // Quick theme detection to prevent FOUC
            const storedTheme = localStorage.getItem('forge-theme');
            const systemPreference = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            const theme = storedTheme || systemPreference;
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="./assets/css/custom.css">
    
    <!-- Theme system JavaScript -->
    <script src="./assets/js/theme.js"></script>
    
    <style>
        /* Test specific styles */
        .test-container {
            max-width: var(--forge-max-width);
            margin: 0 auto;
            padding: var(--forge-space-8);
        }
        
        .test-section {
            margin-bottom: var(--forge-space-8);
            padding: var(--forge-space-6);
            border: 1px solid var(--forge-border);
            border-radius: var(--forge-radius-lg);
        }
        
        .color-swatch {
            display: inline-block;
            width: 50px;
            height: 50px;
            margin: var(--forge-space-2);
            border-radius: var(--forge-radius);
            border: 1px solid var(--forge-border);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--forge-space-4);
            margin-top: var(--forge-space-4);
        }
        
        .test-results {
            background: var(--forge-background-secondary);
            padding: var(--forge-space-4);
            border-radius: var(--forge-radius-md);
            margin-top: var(--forge-space-4);
            font-family: var(--forge-font-mono);
            font-size: var(--forge-text-sm);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: var(--forge-space-2);
        }
        
        .status-pass { background-color: var(--forge-success); }
        .status-fail { background-color: var(--forge-error); }
        .status-warn { background-color: var(--forge-warning); }
    </style>
</head>
<body>
    <div class="test-container">
        <header class="site-header">
            <h1>FORGE Theme System Test</h1>
            <div class="site-nav">
                <!-- Theme toggle will be injected here by JavaScript -->
            </div>
        </header>
        
        <main>
            <!-- Color Palette Test -->
            <section class="test-section">
                <h2>Color Palette Test</h2>
                <p>Testing custom CSS properties and theme switching:</p>
                
                <div>
                    <h3>Primary Colors</h3>
                    <div class="color-swatch" style="background-color: var(--forge-primary);" title="Primary"></div>
                    <div class="color-swatch" style="background-color: var(--forge-primary-hover);" title="Primary Hover"></div>
                    <div class="color-swatch" style="background-color: var(--forge-secondary);" title="Secondary"></div>
                    <div class="color-swatch" style="background-color: var(--forge-secondary-hover);" title="Secondary Hover"></div>
                </div>
                
                <div>
                    <h3>Background Colors</h3>
                    <div class="color-swatch" style="background-color: var(--forge-background);" title="Background"></div>
                    <div class="color-swatch" style="background-color: var(--forge-background-secondary);" title="Background Secondary"></div>
                    <div class="color-swatch" style="background-color: var(--forge-background-tertiary);" title="Background Tertiary"></div>
                </div>
                
                <div>
                    <h3>Text Colors</h3>
                    <div class="color-swatch" style="background-color: var(--forge-text-primary);" title="Text Primary"></div>
                    <div class="color-swatch" style="background-color: var(--forge-text-secondary);" title="Text Secondary"></div>
                    <div class="color-swatch" style="background-color: var(--forge-text-muted);" title="Text Muted"></div>
                </div>
            </section>
            
            <!-- Component Test -->
            <section class="test-section">
                <h2>Component Test</h2>
                <div class="test-grid">
                    <div class="forge-card">
                        <h3 class="forge-card__title">Test Card</h3>
                        <div class="forge-card__content">
                            <p>This card should respond to theme changes with appropriate colors and shadows.</p>
                            <a href="#" class="forge-btn">Primary Button</a>
                            <a href="#" class="forge-btn forge-btn--secondary">Secondary Button</a>
                        </div>
                    </div>
                    
                    <div>
                        <h3>Alert Components</h3>
                        <div class="forge-alert forge-alert--info">
                            <div class="forge-alert__title">Info Alert</div>
                            This is an informational alert message.
                        </div>
                        <div class="forge-alert forge-alert--success">
                            <div class="forge-alert__title">Success Alert</div>
                            This is a success alert message.
                        </div>
                        <div class="forge-alert forge-alert--warning">
                            <div class="forge-alert__title">Warning Alert</div>
                            This is a warning alert message.
                        </div>
                        <div class="forge-alert forge-alert--error">
                            <div class="forge-alert__title">Error Alert</div>
                            This is an error alert message.
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Typography Test -->
            <section class="test-section">
                <h2>Typography Test</h2>
                <h1>Heading 1</h1>
                <h2>Heading 2</h2>
                <h3>Heading 3</h3>
                <h4>Heading 4</h4>
                <h5>Heading 5</h5>
                <h6>Heading 6</h6>
                <p>This is a paragraph with <a href="#">a link</a> and some <code>inline code</code>.</p>
                <pre><code>// This is a code block
function testFunction() {
    return 'Hello, FORGE!';
}</code></pre>
            </section>
            
            <!-- Theme Control Test -->
            <section class="test-section">
                <h2>Theme Control Test</h2>
                <p>Test manual theme switching:</p>
                <button onclick="ForgeTheme.setTheme('light')" class="forge-btn">Force Light Theme</button>
                <button onclick="ForgeTheme.setTheme('dark')" class="forge-btn">Force Dark Theme</button>
                <button onclick="ForgeTheme.toggle()" class="forge-btn forge-btn--secondary">Toggle Theme</button>
                
                <div class="test-results" id="theme-status">
                    Current Theme: <span id="current-theme">Loading...</span><br>
                    System Preference: <span id="system-preference">Loading...</span><br>
                    Stored Theme: <span id="stored-theme">Loading...</span>
                </div>
            </section>
            
            <!-- Accessibility Test -->
            <section class="test-section">
                <h2>Accessibility Test</h2>
                <p>Testing keyboard navigation and screen reader support:</p>
                <div>
                    <button tabindex="0" class="forge-btn">Focusable Button</button>
                    <a href="#" tabindex="0" class="forge-btn forge-btn--secondary">Focusable Link</a>
                    <input type="text" placeholder="Test input" aria-label="Test input field">
                </div>
                <div class="sr-only">This text should only be visible to screen readers.</div>
            </section>
            
            <!-- Test Results -->
            <section class="test-section">
                <h2>Automated Test Results</h2>
                <div id="test-results" class="test-results">
                    Running tests...
                </div>
            </section>
        </main>
    </div>
    
    <script>
        // Automated testing script
        document.addEventListener('DOMContentLoaded', function() {
            const results = [];
            
            // Test 1: Theme Manager Initialization
            try {
                if (window.ForgeTheme && typeof window.ForgeTheme.getCurrentTheme === 'function') {
                    results.push('✅ Theme Manager initialized successfully');
                } else {
                    results.push('❌ Theme Manager not found or incomplete');
                }
            } catch (e) {
                results.push('❌ Theme Manager initialization error: ' + e.message);
            }
            
            // Test 2: CSS Custom Properties
            const testElement = document.createElement('div');
            document.body.appendChild(testElement);
            const computedStyle = getComputedStyle(testElement);
            
            const testProperties = [
                '--forge-primary',
                '--forge-background', 
                '--forge-text-primary',
                '--forge-font-sans',
                '--forge-transition'
            ];
            
            testProperties.forEach(prop => {
                const value = computedStyle.getPropertyValue(prop);
                if (value && value.trim() !== '') {
                    results.push(`✅ CSS Property ${prop}: ${value.trim()}`);
                } else {
                    results.push(`❌ CSS Property ${prop}: Not found or empty`);
                }
            });
            
            document.body.removeChild(testElement);
            
            // Test 3: Theme Toggle Button
            const toggleButton = document.querySelector('.theme-toggle');
            if (toggleButton) {
                results.push('✅ Theme toggle button created');
                
                // Test accessibility attributes
                if (toggleButton.getAttribute('aria-label')) {
                    results.push('✅ Theme toggle has aria-label');
                } else {
                    results.push('❌ Theme toggle missing aria-label');
                }
                
                if (toggleButton.getAttribute('type') === 'button') {
                    results.push('✅ Theme toggle has correct type attribute');
                } else {
                    results.push('❌ Theme toggle missing or incorrect type attribute');
                }
            } else {
                results.push('❌ Theme toggle button not found');
            }
            
            // Test 4: Local Storage
            try {
                localStorage.setItem('test-forge', 'test');
                localStorage.removeItem('test-forge');
                results.push('✅ Local Storage available');
            } catch (e) {
                results.push('⚠️ Local Storage not available: ' + e.message);
            }
            
            // Test 5: Media Query Support
            if (window.matchMedia) {
                const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
                results.push('✅ Media Query support available');
                results.push(`ℹ️ System prefers: ${darkModeQuery.matches ? 'dark' : 'light'} mode`);
            } else {
                results.push('⚠️ Media Query support not available');
            }
            
            // Test 6: Theme Switching
            if (window.ForgeTheme) {
                const originalTheme = window.ForgeTheme.getCurrentTheme();
                const newTheme = originalTheme === 'light' ? 'dark' : 'light';
                
                try {
                    window.ForgeTheme.setTheme(newTheme);
                    const currentTheme = window.ForgeTheme.getCurrentTheme();
                    
                    if (currentTheme === newTheme) {
                        results.push('✅ Theme switching works correctly');
                        
                        // Test DOM update
                        const themeAttr = document.documentElement.getAttribute('data-theme');
                        if (themeAttr === newTheme) {
                            results.push('✅ DOM theme attribute updated correctly');
                        } else {
                            results.push('❌ DOM theme attribute not updated');
                        }
                        
                        // Restore original theme
                        window.ForgeTheme.setTheme(originalTheme);
                    } else {
                        results.push('❌ Theme switching failed');
                    }
                } catch (e) {
                    results.push('❌ Theme switching error: ' + e.message);
                }
            }
            
            // Test 7: Focus Management
            const focusableElements = document.querySelectorAll('button, [href], input, [tabindex]:not([tabindex="-1"])');
            if (focusableElements.length > 0) {
                results.push(`✅ Found ${focusableElements.length} focusable elements`);
            } else {
                results.push('⚠️ No focusable elements found');
            }
            
            // Test 8: Reduced Motion Support
            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
            if (prefersReducedMotion) {
                results.push('✅ Reduced motion media query supported');
            } else {
                results.push('⚠️ Reduced motion media query not supported');
            }
            
            // Display results
            document.getElementById('test-results').innerHTML = results.join('<br>');
            
            // Update theme status display
            updateThemeStatus();
        });
        
        function updateThemeStatus() {
            if (window.ForgeTheme) {
                document.getElementById('current-theme').textContent = window.ForgeTheme.getCurrentTheme();
            }
            
            const systemPreference = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            document.getElementById('system-preference').textContent = systemPreference;
            
            try {
                const stored = localStorage.getItem('forge-theme');
                document.getElementById('stored-theme').textContent = stored || 'None';
            } catch (e) {
                document.getElementById('stored-theme').textContent = 'Error: ' + e.message;
            }
        }
        
        // Listen for theme changes
        window.addEventListener('themechange', function(e) {
            console.log('Theme change event received:', e.detail);
            updateThemeStatus();
        });
        
        // Update status every few seconds
        setInterval(updateThemeStatus, 3000);
    </script>
</body>
</html>